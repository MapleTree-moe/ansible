# {{ ansible_managed }}
# {{ ansible_fqdn }}
# TODO: it would be nice to have the recent git commit here

[Container]
AutoUpdate=registry
ContainerName=traefik
Image=docker.io/traefik:v2.10.5
Network=traefik.network
Volume=/%t/podman/podman.sock:/var/run/docker.sock:ro

PublishPort=8080:80
PublishPort=8443:443

Label=traefik.enable="true"
Label=traefik.http.routers.dashboard.rule="Host(`traefik.{{ ansible_fqdn }}`) && (PathPrefix(`/api`) || PathPrefix(`/dashboard`))"
Label=traefik.http.routers.dashboard.service="api@internal"
Label=traefik.http.routers.dashboard.middlewares="auth"
Label=traefik.http.middlewares.auth.basicauth.users="{{ containers_traefik_dashboard_user }}:{{ containers_traefik_dashboard_password | password_hash('bcrypt') }}"

[Service]
Restart=on-failure
MemoryMax=512M

[Install]
WantedBy=multi-user.target default.target

[Unit]
Description=Traefik container
Documentation=https://traefik.io
After=network-online.target
