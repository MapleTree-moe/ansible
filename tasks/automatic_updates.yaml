###
### mapletree.moe - system configuration management
### enable automatic updates
###
---
- name: Ensure system automatically applies security updates
  block:
    - name: Ensure dnf-automatic package is installed
      ansible.builtin.package:
        name: dnf-automatic
        state: present
    - name: Ensure dnf-automatic package is propertly configured
      ansible.builtin.lineinfile:
        path: /etc/dnf/automatic.conf
        regexp: '^{{ item.name }}'
        line: '{{ item.name }} = {{ item.value }}'
      with_items:
        - name: upgrade_type
          value: security
        - name: download_updates
          value: 'yes'
        - name: apply_updates
          value: 'yes'
        - name: reboot
          value: 'when-needed'
    - name: Ensure dnf-automatic systemd timer is enabled
      ansible.builtin.service:
        name: dnf-automatic.timer
        state: started
        enabled: true
